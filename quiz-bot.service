[Unit]
Description=Telegram Quiz Bot Service (Modullashtirilgan)
After=network.target postgresql.service
Wants=postgresql.service

[Service]
Type=simple
User=azureuser
Group=azureuser
WorkingDirectory=/home/azureuser/quiz-bot
Environment="PYTHONPATH=/home/azureuser/quiz-bot"
Environment="PYTHONUNBUFFERED=1"

# Environment variables .env fayldan o'qiladi yoki quyidagilarni ishlatish mumkin:
# BOT_TOKEN .env fayldan o'qiladi (majburiy)
# DATABASE_URL .env fayldan o'qiladi yoki quyidagilar ishlatiladi:
# Environment="DB_USER=quizbot"
# Environment="DB_PASSWORD=quizbot123"
# Environment="DB_HOST=localhost"
# Environment="DB_PORT=5432"
# Environment="DB_NAME=quizbot"

# Admin va API keys (ixtiyoriy, .env fayldan ham o'qilishi mumkin)
# Environment="ADMIN_USER_IDS=75379661x029"
# Environment="DEEPSEEK_API_KEY=sk-2ef0592830e84305825f6344f408e226"

# Database sozlamalari
Environment="USE_DATABASE=true"
Environment="DB_ECHO=false"

# Quiz limitlari (ixtiyoriy, default qiymatlar ishlatiladi)
# Environment="MAX_ACTIVE_QUIZZES_PER_GROUP=2"
# Environment="MAX_ACTIVE_QUIZZES_PER_USER_IN_GROUP=1"
# Environment="MAX_ACTIVE_QUIZZES_PER_USER_PRIVATE=3"

# AI va file parsing limitlari
# Environment="MIN_QUESTIONS_REQUIRED=2"
# Environment="MAX_QUESTIONS_PER_QUIZ=100"
# Environment="TARGET_QUESTIONS_PER_QUIZ=50"
# Environment="MAX_TEXT_CHARS_FOR_AI=35000"
# Environment="MAX_AI_SECONDS=180"
# Environment="MAX_CONCURRENT_AI_REQUESTS=2"

# Webhook sozlamalari (polling uchun false qiling)
Environment="USE_WEBHOOK=false"
# Environment="WEBHOOK_URL=https://yourdomain.com"
# Environment="WEBHOOK_PORT=8443"
# Environment="WEBHOOK_PATH=/webhook"

# Bot ishga tushirish
ExecStart=/home/azureuser/quiz-bot/venv/bin/python3 bot/main.py

# Restart policy
Restart=always
RestartSec=10
StartLimitInterval=300
StartLimitBurst=5

# Logging
StandardOutput=append:/home/azureuser/quiz-bot/logs/bot.log
StandardError=append:/home/azureuser/quiz-bot/logs/bot_error.log

# Security
NoNewPrivileges=true
PrivateTmp=true

# Resource limits (ixtiyoriy)
# MemoryLimit=512M
# CPUQuota=50%

[Install]
WantedBy=multi-user.target
